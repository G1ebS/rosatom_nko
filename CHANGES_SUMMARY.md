# Сводка изменений

## Что было сделано

### 1. Добавлены новые модели в БД

#### Material (Материалы)
- Поля: title, description, course, author, url, views_count
- Связь ManyToMany с Tag (теги)
- Поддержка тегов для фильтрации и поиска

#### Tag (Теги)
- Поля: name, slug
- Используются для категоризации материалов

#### UserLibrary (Библиотека пользователя)
- Связь User -> Material
- Поле notes для заметок пользователя
- Позволяет пользователям сохранять материалы

### 2. Создан скрипт загрузки данных из CSV

**Команда:** `python manage.py load_csv_data`

Загружает:
- НКО из `backend/api/res.csv` (формат: Город; Категория; Название; Описание; Ссылка)
- Материалы из `backend/api/materials.csv` (формат: Теги; Название; Курс; Автор; Ссылка)

### 3. API Endpoints

#### Материалы
- `GET /api/materials/` - Список материалов (с фильтрацией по тегам, курсу, автору)
- `GET /api/materials/{id}/` - Детали материала
- `POST /api/materials/{id}/save/` - Добавить в библиотеку
- `DELETE /api/materials/{id}/unsave/` - Удалить из библиотеки
- `POST /api/materials/{id}/view/` - Увеличить счетчик просмотров

#### Теги
- `GET /api/tags/` - Список всех тегов

#### Библиотека пользователя
- `GET /api/library/` - Библиотека текущего пользователя
- `POST /api/library/` - Добавить материал в библиотеку
- `DELETE /api/library/{id}/` - Удалить из библиотеки
- `PATCH /api/library/{id}/` - Обновить заметки

### 4. Обновлен фронтенд

- **Header**: Ссылка "Админка" показывается только администраторам (is_staff или is_superuser)
- **AdminPage**: Проверяет права через is_staff/is_superuser вместо role
- **ProtectedRoute**: Добавлена поддержка requireAdmin для защиты админских страниц
- **API утилита**: Добавлены функции для работы с материалами, тегами и библиотекой

### 5. Безопасность

- Модерация доступна только администраторам (is_staff или is_superuser)
- Обычные пользователи не видят вкладку "Админка" в Header
- API endpoints для модерации проверяют права доступа

## Как использовать

### 1. Применить миграции

```bash
cd backend
python manage.py makemigrations
python manage.py migrate
```

### 2. Загрузить данные из CSV

```bash
python manage.py load_csv_data
```

### 3. Создать администратора

```bash
python manage.py createsuperuser
```

Введите:
- Username (например: `admin`)
- Email (опционально)
- Password

### 4. Войти как администратор

1. Откройте фронтенд
2. Перейдите на `/login`
3. Введите username и password администратора
4. После входа увидите ссылку "Админка" в шапке

## Структура CSV файлов

### res.csv (НКО)
```
Город; Категория; Название; Описание; Ссылка
```

Пример:
```
Ангарск; Местное сообщество и развитие территорий; ОО ТОС АГО "12а микрорайон"; Основная деятельность...; https://vk.com/id746471055
```

### materials.csv (Материалы)
```
Теги; Название; Курс; Автор; Ссылка
```

Теги разделены `{{`:
```
эко{{городская_среда{{обучение; Концепция «Зелёный офис»; Зелёный офис; Ольга Шкабардня; https://vkvideo.ru/...
```

## Новые возможности

1. **База знаний с материалами** - пользователи могут просматривать материалы с фильтрацией по тегам
2. **Библиотека пользователя** - сохранение полезных материалов с заметками
3. **Админ-панель** - доступна только администраторам
4. **Модерация** - скрыта от обычных пользователей

## Файлы для справки

- `backend/SETUP_INSTRUCTIONS.md` - инструкция по настройке
- `backend/CREATE_ADMIN.md` - как создать администратора
- `backend/README_CSV_LOAD.md` - детали загрузки CSV

